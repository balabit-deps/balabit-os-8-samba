From 30202568a181966ea7c56a33dad5e4942e524b75 Mon Sep 17 00:00:00 2001
From: Stefan Metzmacher <metze@samba.org>
Date: Mon, 5 Dec 2022 21:36:23 +0100
Subject: [PATCH] CVE-2022-37966 testparm: warn about 'kerberos encryption
 types = legacy'

BUG: https://bugzilla.samba.org/show_bug.cgi?id=15237

Signed-off-by: Stefan Metzmacher <metze@samba.org>
Reviewed-by: Andrew Bartlett <abartlet@samba.org>
Reviewed-by: Ralph Boehme <slow@samba.org>
(cherry picked from commit c0c25cc0217b082c12330a8c47869c8428a20d0c)
---
 source3/utils/testparm.c | 8 ++++++++
 1 file changed, 8 insertions(+)

--- a/source3/utils/testparm.c
+++ b/source3/utils/testparm.c
@@ -525,6 +525,14 @@ static int do_global_checks(void)
 		ret = 1;
 	}
 
+	if (lp_kerberos_encryption_types() == KERBEROS_ETYPES_LEGACY) {
+		fprintf(stderr,
+			"WARNING: You have configured "
+			"'kerberos encryption types = legacy'. "
+			"Your server is vulernable to "
+			"CVE-2022-37966\n\n");
+	}
+
 	return ret;
 }
 
