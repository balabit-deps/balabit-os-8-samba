Backport of:

From b3ee034b4d457607ef25a5b01da64e1eaf5906dd Mon Sep 17 00:00:00 2001
From: Stefan Metzmacher <metze@samba.org>
Date: Fri, 10 Apr 2020 23:10:28 +0200
Subject: [PATCH] s4:kdc: prefer newer enctypes for preauth responses

This matches Windows KDCs, which was demonstrated by the
krb5.as_req_tests tests.

Signed-off-by: Stefan Metzmacher <metze@samba.org>
Reviewed-by: Andrew Bartlett <abartlet@samba.org>

Autobuild-User(master): Stefan Metzmacher <metze@samba.org>
Autobuild-Date(master): Thu Jul  1 18:37:14 UTC 2021 on sn-devel-184
---
 .../knownfail.d/samba.tests.krb5.as_req_tests | 96 -------------------
 source4/kdc/kdc-heimdal.c                     |  2 +-
 2 files changed, 1 insertion(+), 97 deletions(-)
 delete mode 100644 selftest/knownfail.d/samba.tests.krb5.as_req_tests

--- a/source4/kdc/kdc-heimdal.c
+++ b/source4/kdc/kdc-heimdal.c
@@ -404,7 +404,7 @@ static void kdc_post_fork(struct task_se
 	 * function is use_strongest_server_key=TRUE.
 	 */
 	kdc_config->as_use_strongest_session_key = false;
-	kdc_config->preauth_use_strongest_session_key = false;
+	kdc_config->preauth_use_strongest_session_key = true;
 	kdc_config->tgs_use_strongest_session_key = false;
 	kdc_config->use_strongest_server_key = true;
 
