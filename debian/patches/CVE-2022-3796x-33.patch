From 5127bcfded4c242776bdcc42e8fb5296362d017d Mon Sep 17 00:00:00 2001
From: Stefan Metzmacher <metze@samba.org>
Date: Wed, 23 Nov 2022 15:12:47 +0100
Subject: [PATCH] CVE-2022-37966 system_mitkrb5: require support for aes
 enctypes

This will never fail as we already require a version that supports aes,
but this makes it clearer.

BUG: https://bugzilla.samba.org/show_bug.cgi?id=15237

Signed-off-by: Stefan Metzmacher <metze@samba.org>
Reviewed-by: Joseph Sutton <josephsutton@catalyst.net.nz>
Reviewed-by: Andrew Bartlett <abartlet@samba.org>

(cherry picked from commit a80f8e1b826ee3f9bbb22752464a73b97c2a612d)
[jsutton@samba.org Fixed conflicts due to missing lib='krb5' argument]
---
 wscript_configure_system_mitkrb5 | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/wscript_configure_system_mitkrb5
+++ b/wscript_configure_system_mitkrb5
@@ -159,8 +159,8 @@ conf.CHECK_VARIABLE('AP_OPTS_USE_SUBKEY'
 conf.CHECK_VARIABLE('KV5M_KEYTAB', headers='krb5.h')
 conf.CHECK_VARIABLE('KRB5_KU_OTHER_CKSUM', headers='krb5.h')
 conf.CHECK_VARIABLE('KRB5_KEYUSAGE_APP_DATA_CKSUM', headers='krb5.h')
-conf.CHECK_VARIABLE('ENCTYPE_AES128_CTS_HMAC_SHA1_96', headers='krb5.h')
-conf.CHECK_VARIABLE('ENCTYPE_AES256_CTS_HMAC_SHA1_96', headers='krb5.h')
+conf.CHECK_VARIABLE('ENCTYPE_AES128_CTS_HMAC_SHA1_96', headers='krb5.h', mandatory=True)
+conf.CHECK_VARIABLE('ENCTYPE_AES256_CTS_HMAC_SHA1_96', headers='krb5.h', mandatory=True)
 conf.CHECK_DECLS('KRB5_PDU_NONE', reverse=True, headers='krb5.h')
 conf.CHECK_STRUCTURE_MEMBER('krb5_keytab_entry', 'key', headers='krb5.h',
                             define='HAVE_KRB5_KEYTAB_ENTRY_KEY')
